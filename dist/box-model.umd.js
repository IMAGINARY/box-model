!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).boxModel={})}(this,function(t){function e(t,e,r,n){for(var o=t.length,i=n(t,e),a=new Array(o),u=r/2,s=r/6,f=e+u,c=0;c<o;c+=1)a[c]=t[c]+u*i[c];for(var p=n(a,f),d=0;d<o;d+=1)a[d]=t[d]+u*p[d];for(var l=n(a,f),h=0;h<o;h+=1)a[h]=t[h]+r*l[h],l[h]+=p[h];return p=n(a,e+r),t.map(function(e,r){return t[r]+s*(i[r]+p[r]+2*l[r])})}var r=Object.prototype.hasOwnProperty;function n(t,e){return r.call(t,e)}function o(t,e){throw new Error("Value of unknown "+t+" requested: "+e+". Check your box model definition.")}t.BoxModelEngine=/*#__PURE__*/function(){function t(t,r){void 0===r&&(r={integrator:e}),this.model=void 0,this.integrator=void 0,this.model=t,this.integrator=r.integrator}t.createIdToIdxMap=function(t){return t.reduce(function(t,e,r){return t[e.id]=r,t},{})};var r=t.prototype;return r.evaluateGraph=function(e,r){var i=t.createIdToIdxMap(this.model.stocks),a=function(t){return n(i,t)||o("stock",t),e[i[t]]},u=t.createIdToIdxMap(this.model.parameters),s=this.model.parameters.map(function(t){return t.value}),f=function(t){return n(u,t)||o("parameter",t),s[u[t]]},c=[{items:this.model.flows,name:"flow"},{items:this.model.variables,name:"variable"}].map(function(e){var i=e.items,u=e.name,s=t.createIdToIdxMap(i),c=i.map(function(){return!1}),l=function(t){n(s,t)||o(u,t);var e=s[t];if("boolean"==typeof c[e]){if(c[e])throw new Error("Evaluation cycle detected starting at: "+t);return c[e]=!0,c[e]=i[e].formula(a,p,d,f,r),c[e]}return c[e]};return l.data=c,l}),p=c[0],d=c[1];return this.model.variables.forEach(function(t){return d(t.id)}),this.model.flows.forEach(function(t){return p(t.id)}),{stocks:e,flows:p.data,variables:d.data,parameters:s,t:r}},r.step=function(t,e,r,n){if("number"==typeof e)return this.step3(t,e,r);if(void 0!==n)return this.step4(t,e,r,n);throw new TypeError},r.step3=function(t,e,r){var n=this;return this.stepImpl(t,function(t,e){return n.evaluateGraph(t,e).flows},e,r)},r.step4=function(t,e,r,n){var o=this;return this.stepImpl(t,function(t,n){return n===r?e:o.evaluateGraph(t,n).flows},r,n)},r.stepImpl=function(e,r,n,o){var i=this,a=t.createIdToIdxMap(this.model.flows);return this.integrator(e,n,o,function(t,e){var n=r(t,e),o=function(t){return n[a[t]]},u=function(t){return t.map(o).reduce(function(t,e){return t+e},0)};return i.model.stocks.map(function(t){return u(t.in)-u(t.out)})})},r.stepExt=function(t,e,r,n){if("number"==typeof e)return this.stepExt3(t,e,r);if(void 0!==n)return this.stepExt4(t,e,r,n);throw new TypeError},r.stepExt3=function(t,e,r){var n=this.step(t,e,r);return this.evaluateGraph(n,e+r)},r.stepExt4=function(t,e,r,n){var o=this.step(t,e,r,n);return this.evaluateGraph(o,r+n)},t}(),t.euler=function(t,e,r,n){var o=n(t,e);return t.map(function(t,e){return t+r*o[e]})},t.rk4=e});
//# sourceMappingURL=box-model.umd.js.map
