function t(){return(t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}function n(t,n,r,e){for(var s=t.length,i=e(t,n),o=new Array(s),a=r/2,u=r/6,c=n+a,f=0;f<s;f+=1)o[f]=t[f]+a*i[f];for(var p=e(o,c),h=0;h<s;h+=1)o[h]=t[h]+a*p[h];for(var d=e(o,c),l=0;l<s;l+=1)o[l]=t[l]+r*d[l],d[l]+=p[l];return p=e(o,n+r),t.map(function(n,r){return t[r]+u*(i[r]+p[r]+2*d[r])})}exports.BoxModel=function(){function r(e,s){var i=e.stocks,o=e.flows,a=e.variables,u=e.constants;void 0===s&&(s=n),this.stocks=i,this.flows=o,this.variables=a,this.constants=u,this.integrator=s,this.ensureUniqueIds(),this.idToIdx=t({},r.createIdToIdxMap(i),r.createIdToIdxMap(a),r.createIdToIdxMap(u),r.createIdToIdxMap(o))}var e=r.prototype;return e.ensureUniqueIds=function(){var t=[].concat(this.stocks,this.variables,this.constants,this.flows).map(function(t){return t.id}).reduce(function(t,n,r,e){return e.lastIndexOf(n)!==r&&e.push(n),t},[]);if(t.length>0)throw new Error("Duplicate ids found: "+JSON.stringify(t))},r.createIdToIdxMap=function(t){return t.reduce(function(t,n,r){var e;return Object.assign(t,((e={})[n.id]=r,e))},{})},e.evaluateGraph=function(t,n){var r,e,s=this,i=function(n){return t[s.idToIdx[n]]},o=this.constants.map(function(t){return t.value}),a=function(t){return o[s.idToIdx[t]]},u=function(t){var o=new Array(t.length),u=function(u){var c=s.idToIdx[u];if(null===o[c])throw new Error("Evaluation cycle detected starting at: "+u);return void 0===o[c]&&(o[c]=null,o[c]=t[c].equation(i,r,e,a,n)),o[c]};return u.data=o,u},c=(e=u(this.variables)).data,f=(r=u(this.flows)).data;return this.variables.forEach(function(t){return e(t.id)}),this.flows.forEach(function(t){return r(t.id)}),{stocks:t,flows:f,variables:c,constants:o,t:n}},e.step=function(t,n,r,e){return"number"==typeof n?this.step3(t,n,r):this.step4(t,n,r,e)},e.step3=function(t,n,r){var e=this;return this.stepImpl(t,function(t,n){return e.evaluateGraph(t,n).flows},n,r)},e.step4=function(t,n,r,e){var s=this;return this.stepImpl(t,function(t,e){return e===r?n:s.evaluateGraph(t,e).flows},r,e)},e.stepImpl=function(t,n,r,e){var s=this;return this.integrator(t,r,e,function(t,r){var e=n(t,r),i=function(t){return e[s.idToIdx[t]]},o=function(t){return t.map(i).reduce(function(t,n){return t+n},0)};return s.stocks.map(function(t){return o(t.in)-o(t.out)})})},e.stepExt=function(t,n,r,e){return"number"==typeof n?this.stepExt3(t,n,r):this.stepExt4(t,n,r,e)},e.stepExt3=function(n,r,e){var s=this.step(n,r,e);return t({stocks:s},this.evaluateGraph(s,r+e))},e.stepExt4=function(n,r,e,s){var i=this.step(n,r,e,s);return t({stocks:i},this.evaluateGraph(i,e+s))},r}(),exports.euler=function(t,n,r,e){var s=e(t,n);return t.map(function(t,n){return t+r*s[n]})},exports.rk4=n;
//# sourceMappingURL=box-model.js.map
