function t(){return(t=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function r(t,r,n,e){for(var o=t.length,a=e(t,r),i=Array(o),s=n/2,u=n/6,c=r+s,f=0;f<o;f+=1)i[f]=t[f]+s*a[f];for(var h=e(i,c),p=0;p<o;p+=1)i[p]=t[p]+s*h[p];for(var l=e(i,c),d=0;d<o;d+=1)i[d]=t[d]+n*l[d],l[d]+=h[d];return h=e(i,r+n),t.map(function(r,n){return t[n]+u*(a[n]+h[n]+2*l[n])})}exports.BoxModel=function(){function n(e,o){var a=e.stocks,i=e.flows,s=e.variables,u=e.constants;void 0===o&&(o=r),this.stocks=a,this.flows=i,this.variables=s,this.constants=u,this.integrator=o,this.ensureUniqueIds(),this.idToIdx=t({},n.createIdToIdxMap(a),n.createIdToIdxMap(s),n.createIdToIdxMap(u),n.createIdToIdxMap(i))}var e=n.prototype;return e.ensureUniqueIds=function(){var t=[].concat(this.stocks,this.variables,this.constants,this.flows).map(function(t){return t.id}).reduce(function(t,r,n,e){return e.lastIndexOf(r)!==n&&e.push(r),t},[]);if(t.length>0)throw new Error("Duplicate ids found: "+t)},n.createIdToIdxMap=function(t){var r={};return t.forEach(function(t,n){return r[t.id]=n}),r},e.evaluateGraph=function(t,r){var n=this,e=function(r){return t[n.idToIdx[r]]},o=this.constants.map(function(t){return t.value}),a=function(t){return o[n.idToIdx[t]]},i=function(t){var o=new Array(t.length);return{evaluator:function(i){var s=n.idToIdx[i];if(null===o[s])throw new Error("Evaluation cycle detected starting at: ${id}");return void 0===o[s]&&(o[s]=null,o[s]=t[s].equation(e,h,u,a,r)),o[s]},data:o}},s=i(this.variables),u=s.evaluator,c=s.data,f=i(this.flows),h=f.evaluator,p=f.data;return this.variables.forEach(function(t){return u(t.id)}),this.flows.forEach(function(t){return h(t.id)}),{stocks:t,flows:p,variables:c,constants:o,t:r}},e.step=function(t,r,n,e){return"number"==typeof r?this.step3(t,r,n):this.step4(t,r,n,e)},e.step3=function(t,r,n){var e=this;return this.stepImpl(t,function(t,r){return e.evaluateGraph(t,r).flows},r,n)},e.step4=function(t,r,n,e){var o=this;return this.stepImpl(t,function(t,e){return e===n?r:o.evaluateGraph(t,e).flows},n,e)},e.stepImpl=function(t,r,n,e){var o=this;return this.integrator(t,n,e,function(t,n){var e=r(t,n),a=function(t){return e[o.idToIdx[t]]},i=function(t){return t.map(a).reduce(function(t,r){return t+r},0)};return o.stocks.map(function(t){return i(t.in)-i(t.out)})})},e.stepExt=function(t,r,n,e){return"number"==typeof r?this.stepExt3(t,r,n):this.stepExt4(t,r,n,e)},e.stepExt3=function(r,n,e){var o=this.step(r,n,e);return t({stocks:o},this.evaluateGraph(o,n+e))},e.stepExt4=function(r,n,e,o){var a=this.step(r,n,e,o);return t({stocks:a},this.evaluateGraph(a,e+o))},n}(),exports.euler=function(t,r,n,e){var o=e(t,r);return t.map(function(r,e){return t[e]+n*o[e]})},exports.rk4=r;
//# sourceMappingURL=box-model.js.map
