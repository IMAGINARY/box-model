function t(){return(t=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function r(t,r,n,e){var a=e(t,r);return t.map(function(t,r){return t+n*a[r]})}function n(t,r,n,e){for(var a=t.length,i=e(t,r),s=new Array(a),u=n/2,o=n/6,c=r+u,f=0;f<a;f+=1)s[f]=t[f]+u*i[f];for(var p=e(s,c),h=0;h<a;h+=1)s[h]=t[h]+u*p[h];for(var d=e(s,c),l=0;l<a;l+=1)s[l]=t[l]+n*d[l],d[l]+=p[l];return p=e(s,r+n),t.map(function(r,n){return t[n]+o*(i[n]+p[n]+2*d[n])})}var e=function(){function r(e,a){var i=e.stocks,s=e.flows,u=e.variables,o=e.parameters;void 0===a&&(a=n),this.stocks=i,this.flows=s,this.variables=u,this.parameters=o,this.integrator=a,this.ensureUniqueIds(),this.idToIdx=t({},r.createIdToIdxMap(i),r.createIdToIdxMap(u),r.createIdToIdxMap(o),r.createIdToIdxMap(s))}var e=r.prototype;return e.ensureUniqueIds=function(){var t=[].concat(this.stocks,this.variables,this.parameters,this.flows).map(function(t){return t.id}).reduce(function(t,r,n,e){return e.lastIndexOf(r)!==n&&e.push(r),t},[]);if(t.length>0)throw new Error("Duplicate ids found: "+JSON.stringify(t))},r.createIdToIdxMap=function(t){return t.reduce(function(t,r,n){var e;return Object.assign(t,((e={})[r.id]=n,e))},{})},e.evaluateGraph=function(t,r){var n,e,a=this,i=function(r){return t[a.idToIdx[r]]},s=this.parameters.map(function(t){return t.value}),u=function(t){return s[a.idToIdx[t]]},o=function(t){var s=new Array(t.length),o=function(o){var c=a.idToIdx[o];if(null===s[c])throw new Error("Evaluation cycle detected starting at: "+o);return void 0===s[c]&&(s[c]=null,s[c]=t[c].formula(i,n,e,u,r)),s[c]};return o.data=s,o},c=(e=o(this.variables)).data,f=(n=o(this.flows)).data;return this.variables.forEach(function(t){return e(t.id)}),this.flows.forEach(function(t){return n(t.id)}),{stocks:t,flows:f,variables:c,parameters:s,t:r}},e.step=function(t,r,n,e){return"number"==typeof r?this.step3(t,r,n):this.step4(t,r,n,e)},e.step3=function(t,r,n){var e=this;return this.stepImpl(t,function(t,r){return e.evaluateGraph(t,r).flows},r,n)},e.step4=function(t,r,n,e){var a=this;return this.stepImpl(t,function(t,e){return e===n?r:a.evaluateGraph(t,e).flows},n,e)},e.stepImpl=function(t,r,n,e){var a=this;return this.integrator(t,n,e,function(t,n){var e=r(t,n),i=function(t){return e[a.idToIdx[t]]},s=function(t){return t.map(i).reduce(function(t,r){return t+r},0)};return a.stocks.map(function(t){return s(t.in)-s(t.out)})})},e.stepExt=function(t,r,n,e){return"number"==typeof r?this.stepExt3(t,r,n):this.stepExt4(t,r,n,e)},e.stepExt3=function(r,n,e){var a=this.step(r,n,e);return t({stocks:a},this.evaluateGraph(a,n+e))},e.stepExt4=function(r,n,e,a){var i=this.step(r,n,e,a);return t({stocks:i},this.evaluateGraph(i,e+a))},r}();export{e as BoxModel,r as euler,n as rk4};
//# sourceMappingURL=box-model.module.js.map
