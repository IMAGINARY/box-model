function t(t,r,e,n){var o=n(t,r);return t.map(function(t,r){return t+e*o[r]})}function r(t,r,e,n){for(var o=t.length,i=n(t,r),a=new Array(o),u=e/2,s=e/6,f=r+u,c=0;c<o;c+=1)a[c]=t[c]+u*i[c];for(var p=n(a,f),h=0;h<o;h+=1)a[h]=t[h]+u*p[h];for(var l=n(a,f),d=0;d<o;d+=1)a[d]=t[d]+e*l[d],l[d]+=p[d];return p=n(a,r+e),t.map(function(r,e){return t[e]+s*(i[e]+p[e]+2*l[e])})}var e=Object.prototype.hasOwnProperty;function n(t,r){return e.call(t,r)}function o(t,r){throw new Error("Value of unknown "+t+" requested: "+r+". Check your box model definition.")}var i=/*#__PURE__*/function(){function t(t,e){void 0===e&&(e={integrator:r}),this.model=void 0,this.integrator=void 0,this.model=t,this.integrator=e.integrator}t.createIdToIdxMap=function(t){return t.reduce(function(t,r,e){return t[r.id]=e,t},{})};var e=t.prototype;return e.evaluateGraph=function(r,e){var i,a,u=t.createIdToIdxMap(this.model.stocks),s=function(t){return n(u,t)||o("stock",t),r[u[t]]},f=t.createIdToIdxMap(this.model.parameters),c=this.model.parameters.map(function(t){return t.value}),p=function(t){return n(f,t)||o("parameter",t),c[f[t]]},h=function(r,u){var f=t.createIdToIdxMap(r),c=r.map(function(){return!1}),h=function(t){n(f,t)||o(u,t);var h=f[t];if("boolean"==typeof c[h]){if(c[h])throw new Error("Evaluation cycle detected starting at: "+t);return c[h]=!0,c[h]=r[h].formula(s,i,a,p,e),c[h]}return c[h]};return h.data=c,h};return a=h(this.model.variables,"variable"),i=h(this.model.flows,"flow"),this.model.variables.forEach(function(t){return a(t.id)}),this.model.flows.forEach(function(t){return i(t.id)}),{stocks:r,flows:i.data,variables:a.data,parameters:c,t:e}},e.step=function(t,r,e,n){if("number"==typeof r)return this.step3(t,r,e);if(void 0!==n)return this.step4(t,r,e,n);throw new TypeError},e.step3=function(t,r,e){var n=this;return this.stepImpl(t,function(t,r){return n.evaluateGraph(t,r).flows},r,e)},e.step4=function(t,r,e,n){var o=this;return this.stepImpl(t,function(t,n){return n===e?r:o.evaluateGraph(t,n).flows},e,n)},e.stepImpl=function(r,e,n,o){var i=this,a=t.createIdToIdxMap(this.model.flows);return this.integrator(r,n,o,function(t,r){var n=e(t,r),o=function(t){return n[a[t]]},u=function(t){return t.map(o).reduce(function(t,r){return t+r},0)};return i.model.stocks.map(function(t){return u(t.in)-u(t.out)})})},e.stepExt=function(t,r,e,n){if("number"==typeof r)return this.stepExt3(t,r,e);if(void 0!==n)return this.stepExt4(t,r,e,n);throw new TypeError},e.stepExt3=function(t,r,e){var n=this.step(t,r,e);return this.evaluateGraph(n,r+e)},e.stepExt4=function(t,r,e,n){var o=this.step(t,r,e,n);return this.evaluateGraph(o,e+n)},t}();export{i as BoxModelEngine,t as euler,r as rk4};
//# sourceMappingURL=box-model.module.js.map
